{% load static %}
<!doctype html>
<html lang='ja'>
<head>
  <meta charset='utf-8'>
  {% block title %}{% endblock %}
  <link rel='stylesheet' type='text/css' href="{% static 'css/base.css' %}" />
  <link rel="icon" type="image/png" href="{% static 'image/mi-board-logo.png' %}">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script type="text/javascript" src="{% static 'js/base.js' %}"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/push.js/1.0.12/push.min.js"></script>
  {% block head %}
  {% endblock %}
</head>

<body>


  <header class='base_header'>
    <a href="{% url 'mypage:mypage' user.user_id %}" class='logo_link'><img src="{% static 'image/mi-board-logo.png' %}" class='logo_mi-board'></a>


      <ul class='global_menu_container'>

        <!-- <li class='global_menu_item' id='global_menu_item_ground'><a class='global_menu_item_link' href='{% url "ground:ground_global" %}'><img src="{% static 'image/ground.svg' %}" class='global_menu_image'></a></li> -->
        <li class='global_menu_item' id='global_menu_item_room'><a class='global_menu_item_link' href="{% url 'room:room_home' %}"><img src="{% static 'image/room.png' %}" class='global_menu_image'></a></li>
        <li class='global_menu_item' id='global_menu_item_friend'><a class='global_menu_item_link' href='{% url "friend:friend_home" %}'><img src="{% static 'image/friend.png' %}" class='global_menu_image'></a></li>
        <li class='global_menu_item' id='global_menu_item_mypage'><a class='global_menu_item_link' href='{% url "mypage:mypage" user.user_id %}'><img src="{% static 'image/user.png' %}" class='global_menu_image'></a></li>
        <li class='global_menu_item' id='global_menu_item_board'><a class='global_menu_item_link' href='{% url "board:top_page_board" %}'><img src="{% static 'image/board.png' %}" class='global_menu_image'></a></li>
        <li class='global_menu_item' id='global_menu_item_personal_chat'><a class='global_menu_item_link' href='{% url "personal_chat:personal_chat" %}'><img src="{% static 'image/message.png' %}" class='global_menu_image'></a></li>
        <li class='global_menu_item' id='global_menu_item_stoppo'><a class='global_menu_item_link' href='{% url "stoppo:stoppo" user.user_id %}'><img src="{% static 'image/stoppo.png' %}" class='global_menu_image'></a></li>

      </ul>

    <a class='menu_user' href='{% url "accounts:profile" user.user_id %}'>
      {% if user.user_icon_image %}
      <img src='/media/{{user.user_icon_image}}'>
      {% else %}
      <img src='/static/image/user.svg'>
      {% endif %}
      <div class='menu_user_detail'>
        <p><span style='font-size:0.65vw; font-weight:bold;'>{{ user.points}}</span><span style='font-size:0.4vw;'>ポイント保有</span></p>
        <p style='font-size: 0.7vw; font-weight:bold;'>{{ user.last_name }} {{ user.first_name}}</p>
      </div>
    </a>
  </header>


  <main class='main_content'>
      {% block content %}
      {% endblock %}
  </main>


<div id='notification_box_bg'>
  <ul id='notification_box'>
    <p>新しい通知</p>
  </ul>
</div>

  <div class='notification_area'>

  </div>
  <input type='hidden' value={{user.user_id}} id='notification_user_id'>

  <div id='notification_container'>
    <img src="/static/image/notification_on.png" id="notification_bell">
    <p id='notification_message'>新しい通知があります</p>
  </div>

  <script>
    $.ajax({
      type:'GET',
      url:'/notification/get_notification/',
      success:function(response){
        if(response.length === 0){
          $('#notification_message').hide()
          $('#notification_bell').attr('src','/static/image/notification_off.png')
          var notification_card = "<h2 class='nothing_notification'>新しい通知はありません</h2>"
          $('#notification_box').append(notification_card).trigger('create')
        }else{
          for(var key in response){
            switch(response[key]['fields']['type']){
              case "personal_chat":
                var notification_card = "<li class='notification_item'><a href='/personal_chat/'><div class='notification_from'><img src='/static/image/message.png' class='notification_image'><h2>"+response[key]['fields']['display_name']+"</h2></div><p class='notification_detail'>"+response[key]['fields']['detail']+"</p></a></li>"
                break;
              case "room_chat":
                var notification_card = "<li class='notification_item'><a href='/room/"+response[key]['fields']['room']+"'><div class='notification_from'><img src='/static/image/room.png' class='notification_image'><h2>"+response[key]['fields']['display_name']+"</h2></div><p class='notification_detail'>"+response[key]['fields']['detail']+"</p></a></li>"
                break;
              case "related_board":
                var notification_card = "<li class='notification_item'><a href='/room/"+response[key]['fields']['room']+"'><div class='notification_from'><img src='/static/image/board.png' class='notification_image'><h2>"+response[key]['fields']['display_name']+"</h2></div><p class='notification_detail'>新しい投稿があります</p></a></li>"
                break;
              case "share_file":
                var notification_card = "<li class='notification_item'><a href='/stoppo/{{user.user_id}}/share_box/'><div class='notification_from'><img src='/static/image/stoppo.png' class='notification_image'><h2>"+response[key]['fields']['display_name']+"</h2></div><p class='notification_detail'>ファイルを受信しました</p></a></li>"
                break;
            }
            $('#notification_box').append(notification_card).trigger('create')
          }
      }
      },
      error:function(response){
        console.log('error')
      }
    })
  </script>
</body>
</html>
